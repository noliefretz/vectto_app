/* !
 * @author Sean Coker <sean@seancoker.com>
 * @version 1.11.1
 * @url http://sean.is/poppin/tags
 * @license MIT
 * @description Taggle is a dependency-less tagging library
 */
(function(a,b){"use strict";var c="Taggle";typeof define=="function"&&define.amd?define([],function(){var d=b();return a[c]=d,d}):typeof module=="object"&&module.exports?module.exports=a[c]=b():a[c]=b()})(this,function(){function h(){var a=arguments[0];for(var b=1,c=arguments.length;b<c;b++){var d=arguments[b];for(var e in d)d.hasOwnProperty(e)&&(a[e]=d[e])}return a}function i(a){return Array.isArray?Array.isArray(a):Object.prototype.toString.call(a)==="[object Array]"}function j(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c}function k(a){return a.replace(/^\s+|\s+$/g,"")}function l(a,b){window.attachEvent&&!window.addEventListener?a.innerText=b:a.textContent=b}"use strict";var a=function(){},b=function(){return!0},c=8,d=188,e=9,f=13,g={additionalTagClasses:"",allowDuplicates:!1,saveOnBlur:!1,clearOnBlur:!0,duplicateTagClass:"",containerFocusClass:"active",focusInputOnContainerClick:!0,hiddenInputName:"taggles[]",tags:[],delimeter:",",attachTagId:!1,allowedTags:[],disallowedTags:[],maxTags:null,tabIndex:1,placeholder:"Enter tags...",submitKeys:[d,e,f],preserveCase:!1,inputFormatter:a,tagFormatter:a,onBeforeTagAdd:a,onTagAdd:a,onBeforeTagRemove:b,onTagRemove:a},m=function(a,b){this.settings=h({},g,b),this.measurements={container:{rect:null,style:null,padding:null}},this.container=a,this.tag={values:[],elements:[]},this.list=document.createElement("ul"),this.inputLi=document.createElement("li"),this.input=document.createElement("input"),this.sizer=document.createElement("div"),this.pasting=!1,this.placeholder=null,this.settings.placeholder&&(this.placeholder=document.createElement("span")),typeof a=="string"&&(this.container=document.getElementById(a)),this._id=0,this._setMeasurements(),this._setupTextarea(),this._attachEvents()};return m.prototype._setMeasurements=function(){this.measurements.container.rect=this.container.getBoundingClientRect(),this.measurements.container.style=window.getComputedStyle(this.container);var a=this.measurements.container.style,b=parseInt(a["padding-left"]||a.paddingLeft,10),c=parseInt(a["padding-right"]||a.paddingRight,10),d=parseInt(a["border-left-width"]||a.borderLeftWidth,10),e=parseInt(a["border-right-width"]||a.borderRightWidth,10);this.measurements.container.padding=b+c+d+e},m.prototype._setupTextarea=function(){var a;this.list.className="taggle_list",this.input.type="text",this.input.style.paddingLeft=0,this.input.style.paddingRight=0,this.input.className="taggle_input",this.input.tabIndex=this.settings.tabIndex,this.sizer.className="taggle_sizer";if(this.settings.tags.length)for(var b=0,c=this.settings.tags.length;b<c;b++){var d=this._createTag(this.settings.tags[b]);this.list.appendChild(d)}this.placeholder&&(this.placeholder.style.opacity=0,this.placeholder.classList.add("taggle_placeholder"),this.container.appendChild(this.placeholder),l(this.placeholder,this.settings.placeholder),this.settings.tags.length||(this.placeholder.style.opacity=1));var e=this.settings.inputFormatter(this.input);e&&(this.input=e),this.inputLi.appendChild(this.input),this.list.appendChild(this.inputLi),this.container.appendChild(this.list),this.container.appendChild(this.sizer),a=window.getComputedStyle(this.input).fontSize,this.sizer.style.fontSize=a},m.prototype._attachEvents=function(){var a=this;this.settings.focusInputOnContainerClick&&j(this.container,"click",function(){a.input.focus()}),j(this.input,"focus",this._focusInput.bind(this)),j(this.input,"blur",this._blurEvent.bind(this)),j(this.input,"keydown",this._keydownEvents.bind(this)),j(this.input,"keyup",this._keyupEvents.bind(this))},m.prototype._fixInputWidth=function(){var a,b,c,d,e;this._setMeasurements(),this._setInputWidth(),b=this.input.getBoundingClientRect(),c=this.measurements.container.rect,a=~~c.width,a||(a=~~c.right-~~c.left),d=~~b.left-~~c.left,e=this.measurements.container.padding,this._setInputWidth(a-d-e)},m.prototype._canAdd=function(a,b){if(!b)return!1;var c=this.settings.maxTags;if(c!==null&&c<=this.getTagValues().length)return!1;if(this.settings.onBeforeTagAdd(a,b)===!1)return!1;if(!this.settings.allowDuplicates&&this._hasDupes(b))return!1;var d=this.settings.preserveCase,e=this.settings.allowedTags;if(e.length&&!this._tagIsInArray(b,e,d))return!1;var f=this.settings.disallowedTags;return f.length&&this._tagIsInArray(b,f,d)?!1:!0},m.prototype._tagIsInArray=function(a,b,c){if(c)return b.indexOf(a)!==-1;var d=[].slice.apply(b).map(function(a){return a.toLowerCase()});return d.indexOf(a)!==-1},m.prototype._add=function(a,b){var c=this,d=b||"";typeof b!="string"&&(d=k(this.input.value)),d.split(this.settings.delimeter).map(function(a){return c._formatTag(a)}).forEach(function(b){if(!c._canAdd(a,b))return;var d=c._createTag(b),e=c.list.children,f=e[e.length-1];c.list.insertBefore(d,f),b=c.tag.values[c.tag.values.length-1],c.settings.onTagAdd(a,b),c.input.value="",c._fixInputWidth(),c._focusInput()})},m.prototype._checkLastTag=function(a){a=a||window.event;var b=this.container.querySelectorAll(".taggle"),d=b[b.length-1],e="taggle_hot",f=this.input.classList.contains("taggle_back");this.input.value===""&&a.keyCode===c&&!f?d.classList.contains(e)?(this.input.classList.add("taggle_back"),this._remove(d,a),this._fixInputWidth(),this._focusInput()):d.classList.add(e):d.classList.contains(e)&&d.classList.remove(e)},m.prototype._setInputWidth=function(a){this.input.style.width=(a||10)+"px"},m.prototype._hasDupes=function(a){var b=this.tag.values.indexOf(a),c=this.container.querySelector(".taggle_list"),d;if(this.settings.duplicateTagClass){d=c.querySelectorAll("."+this.settings.duplicateTagClass);for(var e=0,f=d.length;e<f;e++)d[e].classList.remove(this.settings.duplicateTagClass)}return b>-1?(this.settings.duplicateTagClass&&c.childNodes[b].classList.add(this.settings.duplicateTagClass),!0):!1},m.prototype._isConfirmKey=function(a){var b=!1;return this.settings.submitKeys.indexOf(a)>-1&&(b=!0),b},m.prototype._focusInput=function(){this._fixInputWidth(),this.container.classList.contains(this.settings.containerFocusClass)||this.container.classList.add(this.settings.containerFocusClass),this.placeholder&&(this.placeholder.style.opacity=0)},m.prototype._blurEvent=function(a){this.container.classList.contains(this.settings.containerFocusClass)&&this.container.classList.remove(this.settings.containerFocusClass);if(this.settings.saveOnBlur){a=a||window.event,this._listenForEndOfContainer();if(this.input.value!==""){this._confirmValidTagEvent(a);return}this.tag.values.length&&this._checkLastTag(a)}else this.settings.clearOnBlur&&(this.input.value="",this._setInputWidth());!this.tag.values.length&&this.placeholder&&!this.input.value&&(this.placeholder.style.opacity=1)},m.prototype._keydownEvents=function(a){a=a||window.event;var b=a.keyCode;this.pasting=!1,this._listenForEndOfContainer(),b===86&&a.metaKey&&(this.pasting=!0);if(this._isConfirmKey(b)&&this.input.value!==""){this._confirmValidTagEvent(a);return}this.tag.values.length&&this._checkLastTag(a)},m.prototype._keyupEvents=function(a){a=a||window.event,this.input.classList.remove("taggle_back"),l(this.sizer,this.input.value),this.pasting&&this.input.value!==""&&(this._add(a),this.pasting=!1)},m.prototype._confirmValidTagEvent=function(a){a=a||window.event,a.preventDefault?a.preventDefault():a.returnValue=!1,this._add(a)},m.prototype._listenForEndOfContainer=function(){var a=this.sizer.getBoundingClientRect().width,b=this.measurements.container.rect.width-this.measurements.container.padding,c=parseInt(this.sizer.style.fontSize,10);a+c*1.5>parseInt(this.input.style.width,10)&&(this.input.style.width=b+"px")},m.prototype._createTag=function(a){var b=document.createElement("li"),c=document.createElement("button"),d=document.createElement("input"),e=document.createElement("span");a=this._formatTag(a),c.innerHTML="&times;",c.className="close",c.type="button",j(c,"click",this._remove.bind(this,c)),l(e,a),e.className="taggle_text",b.className="taggle "+this.settings.additionalTagClasses,d.type="hidden",d.value=a,d.name=this.settings.hiddenInputName,b.appendChild(e),b.appendChild(c),b.appendChild(d);var f=this.settings.tagFormatter(b);typeof f!="undefined"&&(b=f);if(b instanceof HTMLElement&&b.tagName==="LI")return this.settings.attachTagId&&(this._id+=1,a={text:a,id:this._id}),this.tag.values.push(a),this.tag.elements.push(b),b;throw Error("tagFormatter must return an li element")},m.prototype._remove=function(a,b){function g(e){if(e)return;a.parentNode.removeChild(a),c.tag.elements.splice(f,1),c.tag.values.splice(f,1),c.settings.onTagRemove(b,d),c._focusInput()}var c=this,d,e,f;a.tagName.toLowerCase()!=="li"&&(a=a.parentNode),e=a.tagName.toLowerCase()==="a"?a.parentNode:a,f=this.tag.elements.indexOf(e),d=this.tag.values[f];var h=this.settings.onBeforeTagRemove(b,d,g);if(!h)return;g()},m.prototype._formatTag=function(a){return this.settings.preserveCase?a:a.toLowerCase()},m.prototype.getTags=function(){return{elements:this.getTagElements(),values:this.getTagValues()}},m.prototype.getTagElements=function(){return this.tag.elements},m.prototype.getTagValues=function(){return[].slice.apply(this.tag.values)},m.prototype.getInput=function(){return this.input},m.prototype.getContainer=function(){return this.container},m.prototype.add=function(a){var b=i(a);if(b)for(var c=0,d=a.length;c<d;c++)typeof a[c]=="string"&&this._add(null,a[c]);else this._add(null,a);return this},m.prototype.remove=function(a,b){var c=this.tag.values.length-1,d=!1;while(c>-1){var e=this.tag.values[c];this.settings.attachTagId&&(e=e.text),e===a&&(d=!0,this._remove(this.tag.elements[c]));if(d&&!b)break;c--}return this},m.prototype.removeAll=function(){for(var a=this.tag.values.length-1;a>=0;a--)this._remove(this.tag.elements[a]);return this},m.prototype.setOptions=function(a){return this.settings=h({},this.settings,a||{}),this},m})
